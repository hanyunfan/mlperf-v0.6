Beginning trial 1 of 1
Gathering sys log on node009
:::MLL 1582838898.383 submission_benchmark: {"value": "gnmt", "metadata": {"file": "mlperf_log_utils.py", "lineno": 176}}
:::MLL 1582838898.383 submission_org: {"value": "NVIDIA", "metadata": {"file": "mlperf_log_utils.py", "lineno": 181}}
WARNING: Log validation: Key "submission_division" is not in known gnmt keys.
:::MLL 1582838898.384 submission_division: {"value": "closed", "metadata": {"file": "mlperf_log_utils.py", "lineno": 185}}
:::MLL 1582838898.384 submission_status: {"value": "onprem", "metadata": {"file": "mlperf_log_utils.py", "lineno": 189}}
:::MLL 1582838898.385 submission_platform: {"value": "1xDSS8440", "metadata": {"file": "mlperf_log_utils.py", "lineno": 193}}
:::MLL 1582838898.385 submission_entry: {"value": "{'hardware': 'DSS8440', 'framework': 'PyTorch NVIDIA Release 19.05', 'power': 'N/A', 'notes': 'N/A', 'interconnect': 'Ethernet 100 Gb/sec (4X EDR)', 'os': '\\\\S / ', 'libraries': \"{'container_base': 'Ubuntu-16.04', 'openmpi_version': '3.1.3', 'mofed_version': '4.6-2.1.4', 'cuda_version': '10.1.163', 'cuda_driver_version': '418.67', 'nccl_version': '2.4.6', 'cudnn_version': '7.6.0.64', 'cublas_version': '10.2.0.163', 'trt_version': '5.1.5.0', 'dali_version': '0.9.1'}\", 'compilers': 'gcc (Ubuntu 5.4.0-6ubuntu1~16.04.11) 5.4.0 20160609', 'nodes': \"{'num_nodes': '1', 'cpu': '2x Intel(R) Xeon(R) Gold 6230 CPU @ 2.10GHz', 'num_cores': '40', 'num_vcpus': '40', 'accelerator': 'Tesla V100S-PCIE-32GB', 'num_accelerators': '8', 'sys_mem_size': '754 GB', 'sys_storage_type': 'SATA SSD', 'sys_storage_size': '1x 446.6G + 1x 931.5G', 'cpu_accel_interconnect': 'UPI', 'network_card': '', 'num_network_cards': '0', 'notes': ''}\"}", "metadata": {"file": "mlperf_log_utils.py", "lineno": 197}}
:::MLL 1582838898.386 submission_poc_name: {"value": "Paulius Micikevicius", "metadata": {"file": "mlperf_log_utils.py", "lineno": 201}}
:::MLL 1582838898.386 submission_poc_email: {"value": "pauliusm@nvidia.com", "metadata": {"file": "mlperf_log_utils.py", "lineno": 205}}
Clearing caches
:::MLL 1582838902.483 cache_clear: {"value": true, "metadata": {"file": "<string>", "lineno": 1}}
Launching on node node009
+ pids+=($!)
+ set +x
++ eval echo
+++ echo
+ docker exec -e DGXSYSTEM=DGX1 -e 'MULTI_NODE= --master_port=4651' -e LR=2.0e-3 -e TRAIN_BATCH_SIZE=256 -e TEST_BATCH_SIZE=128 -e WARMUP_STEPS=200 -e REMAIN_STEPS=6453 -e DECAY_INTERVAL=809 -e TARGET=24.0 -e NUMEPOCHS=8 -e MAX_SEQ_LEN=75 -e 'EXTRA_OPTS=   --fused-attention    --fused-xentropy    --no-log-all-ranks    ' -e SLURM_JOB_ID=200227152654478851375 -e SLURM_NTASKS_PER_NODE= -e SLURM_NNODES=1 cont_200227152654478851375 ./run_and_time.sh
Run vars: id 200227152654478851375 gpus 8 mparams  --master_port=4651
STARTING TIMING RUN AT 2020-02-27 09:28:23 PM
+ DATASET_DIR=/data
+ PREPROC_DATADIR=/preproc_data
+ RESULTS_DIR=gnmt_wmt16
+ LR=2.0e-3
+ TRAIN_BATCH_SIZE=256
+ TEST_BATCH_SIZE=128
+ WARMUP_STEPS=200
+ REMAIN_STEPS=6453
+ DECAY_INTERVAL=809
+ TARGET=24.0
+ MAX_SEQ_LEN=75
+ NUMEPOCHS=8
+ EXTRA_OPTS='   --fused-attention    --fused-xentropy    --no-log-all-ranks    '
+ BIND_LAUNCH=0
+ MATH=amp_fp16
+ [[ 0 -eq 1 ]]
+ LAUNCH_OPT='torch.distributed.launch --nproc_per_node 8  --master_port=4651'
running benchmark
+ echo 'running benchmark'
+ python -m torch.distributed.launch --nproc_per_node 8 --master_port=4651 train.py --save gnmt_wmt16 --dataset-dir /data --preproc-data-dir /preproc_data --target-bleu 24.0 --epochs 8 --math amp_fp16 --max-length-train 75 --print-freq 10 --train-batch-size 256 --test-batch-size 128 --optimizer FusedAdam --lr 2.0e-3 --warmup-steps 200 --remain-steps 6453 --decay-interval 809 --fused-attention --fused-xentropy --no-log-all-ranks
:::MLL 1582838905.539 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.539 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.539 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.540 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.541 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.541 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.541 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
:::MLL 1582838905.542 init_start: {"value": null, "metadata": {"file": "train.py", "lineno": 288}}
0: Saving results to: results/gnmt_wmt16
0: Run arguments: Namespace(apex_message_size=10000000.0, apex_num_allreduce_streams=1, batching='bucketing', beam_size=5, cov_penalty_factor=0.1, cuda=True, cudnn=True, dataset_dir='/data', decay_factor=0.5, decay_interval=809, decay_steps=8, dropout=0.2, enable_apex_allreduce_overlap=False, env=False, epochs=8, eval=True, fused_attention=True, fused_xentropy=True, grad_clip=5.0, hidden_size=1024, init_scale=1024, intra_epoch_eval=0, keep_checkpoints=0, len_norm_const=5.0, len_norm_factor=0.6, local_rank=0, log_all_ranks=False, lr=0.002, math='amp_fp16', max_length_test=150, max_length_train=75, max_size=None, min_length_test=0, min_length_train=0, num_buckets=5, num_layers=4, optimizer='FusedAdam', optimizer_extra='{}', prealloc_mode='always', preproc_data_dir='/preproc_data', print_freq=10, rank=0, remain_steps=6453, results_dir='results', resume=None, save='gnmt_wmt16', save_all=False, save_freq=5000, save_path='results/gnmt_wmt16', seed=None, shard_size=80, share_embedding=True, smoothing=0.1, start_epoch=0, target_bleu=24.0, test_batch_size=128, test_loader_workers=0, train_batch_size=256, train_global_batch_size=None, train_iter_size=1, train_loader_workers=1, upscale_interval=128, use_preproc_data=True, warmup_steps=200)
0: L2 promotion: 128B
0: Using random master seed: 1292592265
NCCL version 2.5.6+cuda10.2
0: Worker 0 is using worker seed: 2460273475
0: Building vocabulary from /data/vocab.bpe.32000
0: Size of vocabulary: 32320
0: Fused attention flag set to True
0: GNMT(
  (encoder): ResidualRecurrentEncoder(
    (rnn_layers): ModuleList(
      (0): EmuBidirLSTM(
        (bidir): LSTM(1024, 1024, bidirectional=True)
        (layer1): LSTM(1024, 1024)
        (layer2): LSTM(1024, 1024)
      )
      (1): LSTM(2048, 1024)
      (2): LSTM(1024, 1024)
      (3): LSTM(1024, 1024)
    )
    (dropout): Dropout(p=0.2)
    (embedder): Embedding(32320, 1024, padding_idx=0)
  )
  (decoder): ResidualRecurrentDecoder(
    (att_rnn): RecurrentAttention(
      (rnn): LSTM(1024, 1024)
      (attn): BahdanauAttention(
        (linear_q): Linear(in_features=1024, out_features=1024, bias=False)
        (linear_k): Linear(in_features=1024, out_features=1024, bias=False)
      )
      (dropout): Dropout(p=0.2)
    )
    (rnn_layers): ModuleList(
      (0): LSTM(2048, 1024)
      (1): LSTM(2048, 1024)
      (2): LSTM(2048, 1024)
    )
    (embedder): Embedding(32320, 1024, padding_idx=0)
    (classifier): Classifier(
      (classifier): Linear(in_features=1024, out_features=32320, bias=True)
    )
    (dropout): Dropout(p=0.2)
  )
)
0: Building LabelSmoothingLoss (smoothing: 0.1)
0: Fused xentropy flag set to True
0: Training optimizer config: {'optimizer': 'FusedAdam', 'lr': 0.002}
0: Number of parameters: 160671297
0: Saving state of the tokenizer
Selected optimization level O2:  FP16 training with FP32 batchnorm and FP32 master weights.

Defaults for this optimization level are:
enabled                : True
opt_level              : O2
cast_model_type        : torch.float16
patch_torch_functions  : False
keep_batchnorm_fp32    : True
master_weights         : True
loss_scale             : dynamic
Processing user overrides (additional kwargs that are not None)...
After processing overrides, optimization options are:
enabled                : True
opt_level              : O2
cast_model_type        : torch.float16
patch_torch_functions  : False
keep_batchnorm_fp32    : False
master_weights         : True
loss_scale             : dynamic
0: Initializing amp optimizer
0: Using optimizer: FusedAdam (
Parameter Group 0
    betas: (0.9, 0.999)
    bias_correction: True
    eps: 1e-08
    lr: 0.002
    max_grad_norm: 5.0
    weight_decay: 0.0
)
:::MLL 1582838917.462 opt_base_learning_rate: {"value": 0.002, "metadata": {"file": "seq2seq/train/trainer.py", "lineno": 169}}
0: Executing preallocation
:::MLL 1582838918.789 init_stop: {"value": null, "metadata": {"file": "train.py", "lineno": 407}}
:::MLL 1582838918.789 run_start: {"value": null, "metadata": {"file": "train.py", "lineno": 409}}
:::MLL 1582838918.790 max_sequence_length: {"value": 75, "metadata": {"method": "discard", "file": "train.py", "lineno": 414}}
0: Reading preprocessed data file from /preproc_data/training.bin
0: Preprocessed data: length: 3975116 min length: 0 max length: 75 
0: Opening preprocessed data /preproc_data/training.bin for reading
0: Processing data from /data/newstest2014.tok.bpe.32000.en
0: Filtering data, min len: 0, max len: 150
0: Pairs before: 3003, after: 3003
:::MLL 1582838919.774 global_batch_size: {"value": 2048, "metadata": {"file": "train.py", "lineno": 459}}
0: Training LR schedule config: {'warmup_steps': 200, 'remain_steps': 6453, 'decay_interval': 809, 'decay_steps': 8, 'decay_factor': 0.5}
0: Scheduler warmup steps: 200
0: Scheduler remain steps: 6453
0: Scheduler decay interval: 809
0: Scheduler decay factor: 0.5
0: Scheduler max decay steps: 8
:::MLL 1582838919.775 opt_learning_rate_alt_decay_func: {"value": true, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 78}}
:::MLL 1582838919.776 opt_learning_rate_alt_warmup_func: {"value": true, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 80}}
:::MLL 1582838919.776 opt_learning_rate_decay_interval: {"value": 809, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 83}}
:::MLL 1582838919.776 opt_learning_rate_decay_factor: {"value": 0.5, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 85}}
:::MLL 1582838919.776 opt_learning_rate_decay_steps: {"value": 8, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 87}}
:::MLL 1582838919.777 opt_learning_rate_remain_steps: {"value": 6453, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 89}}
:::MLL 1582838919.777 opt_learning_rate_warmup_steps: {"value": 200, "metadata": {"file": "seq2seq/train/lr_scheduler.py", "lineno": 91}}
:::MLL 1582838919.840 block_start: {"value": null, "metadata": {"first_epoch_num": 1, "epoch_count": 1, "file": "train.py", "lineno": 512}}
:::MLL 1582838919.840 epoch_start: {"value": null, "metadata": {"epoch_num": 1, "file": "train.py", "lineno": 515}}
0: Starting epoch 0
0: Executing preallocation
0: Sampler for epoch 0 uses seed 3776747407
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
0: TRAIN [0][0/1938]	Time 1.067 (1.067)	Data 8.02e-01 (8.02e-01)	Tok/s 15786 (15786)	Loss/tok 10.6515 (10.6515)	LR 2.000e-05
0: TRAIN [0][10/1938]	Time 0.192 (0.298)	Data 1.19e-04 (7.30e-02)	Tok/s 54369 (52668)	Loss/tok 9.7588 (10.2775)	LR 2.518e-05
0: TRAIN [0][20/1938]	Time 0.252 (0.263)	Data 1.10e-04 (3.83e-02)	Tok/s 66907 (55900)	Loss/tok 9.3813 (9.9062)	LR 3.170e-05
0: TRAIN [0][30/1938]	Time 0.140 (0.243)	Data 1.45e-04 (2.60e-02)	Tok/s 37542 (55347)	Loss/tok 8.7114 (9.6960)	LR 3.991e-05
0: TRAIN [0][40/1938]	Time 0.138 (0.236)	Data 1.18e-04 (1.97e-02)	Tok/s 37930 (55635)	Loss/tok 8.5946 (9.5102)	LR 5.024e-05
0: TRAIN [0][50/1938]	Time 0.410 (0.243)	Data 1.29e-04 (1.58e-02)	Tok/s 73452 (57385)	Loss/tok 8.7353 (9.3169)	LR 6.325e-05
0: TRAIN [0][60/1938]	Time 0.193 (0.237)	Data 1.36e-04 (1.33e-02)	Tok/s 54026 (57075)	Loss/tok 8.2518 (9.1889)	LR 7.962e-05
0: TRAIN [0][70/1938]	Time 0.195 (0.232)	Data 1.31e-04 (1.14e-02)	Tok/s 53169 (56750)	Loss/tok 8.1231 (9.0706)	LR 1.002e-04
0: TRAIN [0][80/1938]	Time 0.140 (0.227)	Data 1.12e-04 (1.00e-02)	Tok/s 37444 (55980)	Loss/tok 7.4201 (8.9673)	LR 1.262e-04
0: TRAIN [0][90/1938]	Time 0.190 (0.225)	Data 1.04e-04 (8.93e-03)	Tok/s 53814 (55947)	Loss/tok 7.8735 (8.8681)	LR 1.589e-04
0: TRAIN [0][100/1938]	Time 0.140 (0.223)	Data 1.24e-04 (8.06e-03)	Tok/s 37209 (55689)	Loss/tok 7.1886 (8.7798)	LR 2.000e-04
0: TRAIN [0][110/1938]	Time 0.194 (0.223)	Data 1.22e-04 (7.35e-03)	Tok/s 53054 (55841)	Loss/tok 7.7216 (8.6983)	LR 2.518e-04
0: TRAIN [0][120/1938]	Time 0.191 (0.220)	Data 1.18e-04 (6.75e-03)	Tok/s 54420 (55475)	Loss/tok 7.7111 (8.6338)	LR 3.170e-04
0: TRAIN [0][130/1938]	Time 0.196 (0.222)	Data 1.29e-04 (6.24e-03)	Tok/s 53389 (56031)	Loss/tok 7.7200 (8.5621)	LR 3.991e-04
0: TRAIN [0][140/1938]	Time 0.254 (0.223)	Data 1.14e-04 (5.81e-03)	Tok/s 66504 (56309)	Loss/tok 7.8963 (8.4997)	LR 5.024e-04
0: TRAIN [0][150/1938]	Time 0.140 (0.223)	Data 1.19e-04 (5.43e-03)	Tok/s 37907 (56488)	Loss/tok 7.1132 (8.4427)	LR 6.325e-04
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 256.0
0: TRAIN [0][160/1938]	Time 0.195 (0.225)	Data 1.17e-04 (5.10e-03)	Tok/s 54129 (56880)	Loss/tok 7.4731 (8.3881)	LR 7.781e-04
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
0: TRAIN [0][170/1938]	Time 0.195 (0.225)	Data 1.13e-04 (4.81e-03)	Tok/s 53130 (56928)	Loss/tok 7.2616 (8.3361)	LR 9.573e-04
0: TRAIN [0][180/1938]	Time 0.255 (0.227)	Data 1.18e-04 (4.55e-03)	Tok/s 64772 (57301)	Loss/tok 7.5180 (8.2779)	LR 1.205e-03
0: TRAIN [0][190/1938]	Time 0.255 (0.229)	Data 1.27e-04 (4.32e-03)	Tok/s 65742 (57649)	Loss/tok 7.2545 (8.2159)	LR 1.517e-03
0: TRAIN [0][200/1938]	Time 0.193 (0.229)	Data 1.17e-04 (4.11e-03)	Tok/s 53074 (57788)	Loss/tok 6.9239 (8.1555)	LR 1.910e-03
